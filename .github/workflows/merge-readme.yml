name: Merge Bilingual README

on:
  # å½“æ¨é€åˆ°ä¸»åˆ†æ”¯æ—¶è§¦å‘
  push:
    branches: [ main, master ]
  # å…è®¸æ‰‹åŠ¨è§¦å‘å·¥ä½œæµ
  workflow_dispatch:

jobs:
  merge-readmes:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          # ç¡®ä¿æœ‰è¶³å¤Ÿçš„æƒé™æäº¤æ›´æ”¹
          token: ${{ secrets.GITHUB_TOKEN }}
          # è·å–æ‰€æœ‰å†å²è®°å½•ï¼Œä»¥ä¾¿åç»­æäº¤
          fetch-depth: 0
      
      - name: Validate README files exist
        run: |
          if [ ! -f "README.zh.md" ]; then
            echo "Error: README.zh.md not found!"
            exit 1
          fi
          if [ ! -f "README.en.md" ]; then
            echo "Error: README.en.md not found!"
            exit 1
          fi
      
      - name: Merge README files
        run: |
          # åˆ›å»ºåˆå¹¶åçš„ README æ–‡ä»¶
          echo "# ğŸ“– README | [ä¸­æ–‡](README.md#ä¸­æ–‡è¯´æ˜) | [English](README.md#english-version)" > README.md
          echo -e "\n## ä¸­æ–‡è¯´æ˜\n" >> README.md
          cat README.zh.md >> README.md
          echo -e "\n\n## English Version\n" >> README.md
          cat README.en.md >> README.md
          
          # æ˜¾ç¤ºåˆå¹¶åçš„æ–‡ä»¶å†…å®¹ï¼ˆç”¨äºè°ƒè¯•ï¼‰
          echo "--- åˆå¹¶åçš„ README.md å†…å®¹ ---"
          cat README.md
          echo "--- å†…å®¹ç»“æŸ ---"
      
      - name: Commit and push changes
        run: |
          # é…ç½® Git ç”¨æˆ·ä¿¡æ¯
          git config user.name "GitHub Action"
          git config user.email "action@github.com"
          
          # æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶æ›´æ”¹
          git diff --exit-code || (
            # æœ‰æ›´æ”¹æ—¶æäº¤å¹¶æ¨é€
            git add README.md
            git commit -m "ğŸ¤– è‡ªåŠ¨åˆå¹¶åŒè¯­ README [skip ci]"
            git push
          )
